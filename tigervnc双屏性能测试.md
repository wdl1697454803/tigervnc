# tigervnc双屏性能测试

## 测试环境

【时间】20230324、20230327

【系统】

银河麒麟V10国防版（2205）：5.4.18-52

银河麒麟V10国防版（2207）：5.4.18-65

Ubuntu 20.04.5 LTS：5.10.110

【CPU】飞腾D2000/8、RK3588瘦终端

【显卡】JH920

【驱动版本】

核内、核外：1.3.0

视频编解码：1.2.14

【tigervnc版本】

20230324的主线代码



## 测试内容

**测试内容有部分存在主观感受，仅供参考！！！**

### 综合测试

|                       | 服务端（server）：5.4.18-52（2205）<br/>客户端（client）：5.4.18-65（2207）<br/>左右双屏：左屏显示2560x1440、右屏显示1920x1080（2K+1K） | 服务端（server）：5.4.18-52（2205）<br/>客户端（client）：5.4.18-65（2207）<br/>上下双屏：上屏显示2560x1440、下屏显示1920x1080（2K+1K） | 服务端（server）：5.4.18-52（2205）<br/>客户端（client）：5.4.18-65（2207）<br/>左右双屏：左屏显示1920x1080、右屏显示1920x1080（1K+1K） | 服务端server：5.4.18-65（2207）<br/> 客户端client：5.4.18-52（2205）<br/>上下双屏：上屏显示2560x1440、下屏显示1920x1080（2K+1K） | 服务端（server）：5.4.18-52（2205）<br/>客户端（client）：RK3588瘦终端<br/>左右双屏：左屏显示2560x1440、右屏显示1920x1080（2K+1K） | 服务端（server）：5.4.18-52（2205）<br/>客户端（client）：RK3588瘦终端<br/>左右双屏：左屏显示1920x1080、右屏显示1920x1080（1K+1K） |
| --------------------- | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 压缩编码              | Tight                                                        | Tight                                                        | Tight                                                        | Tight                                                        | Tight                                                        | Tight                                                        |
| 颜色级别              | Full                                                         | Full                                                         | Full                                                         | Full                                                         | Full                                                         | Full                                                         |
| JPEG压缩级别          | 8                                                            | 8                                                            | 8                                                            | 8                                                            | 8                                                            | 8                                                            |
| 普通操作测试          | 拖动窗口：流畅度高<br/>文字输入：流畅度高                    | 拖动窗口：流畅度高<br/>文字输入：流畅度高                    | 拖动窗口：流畅度高<br/>文字输入：流畅度高                    | 拖动窗口：流畅度高<br/>文字输入：流畅度高                    | 拖动窗口：流畅度高<br/>文字输入：流畅度高                    | 拖动窗口：流畅度高<br/>文字输入：流畅度高                    |
| H264-4K-30视频测试    | **4K视频2K屏全屏显示，1K视频1K屏全屏显示**<br/>GPU的3D使用率：20-25<br/>视频体验：有明显掉帧，流畅度一般<br/>播放时操作窗口操作：有卡顿感<br/>播放时输入字符：有卡顿感<br/>X0vncserver：（系统监视器）<br/>CPU使用率：70-80%<br/>网络：4-6MB/s左右 | **4K视频2K屏全屏显示，1K视频1K屏全屏显示**<br/>GPU的3D使用率：20-25<br/>视频体验：有明显掉帧，流畅度一般<br/>播放时操作窗口操作：有卡顿感<br/>播放时输入字符：有卡顿感<br/>X0vncserver：（系统监视器）<br/>CPU使用率：70-80%<br/>网络：4-6MB/s左右 | **4K视频1K屏全屏显示，1K视频1K屏全屏显示**<br/>GPU的3D使用率：15-20<br/>体验：较流畅，掉帧情况比2K下好<br/>播放时操作窗口操作：较流畅<br/>播放时输入字符：较流畅<br/>X0vncserver：（系统监视器）<br/>CPU使用率：70-80%<br/>网络：4-6MB/s左右 | **4K视频1K屏全屏显示，1K视频1K屏全屏显示**<br/>GPU的3D使用率：25-30<br/>视频体验：有明显掉帧，流畅度一般<br/>播放时操作窗口操作：有卡顿感<br/>播放时输入字符：有卡顿感<br/>X0vncserver：（系统监视器）<br/>CPU使用率：70-80%<br/>网络：4-6MB/s左右 | 性能数据和2205系统作为客户端接近，后续未进行测试             | 性能数据和2205系统作为客户端接近，后续未进行测试             |
| H264-4K-60视频测试    | GPU的3D使用率：25-30<br/>体验：有明显掉帧，流畅度一般<br/>播放时操作窗口：有卡顿感<br/>播放时输入字符：有卡顿感<br/>X0vncserver：（系统监视器）<br/>CPU使用率：70-80%<br/>网络：4-6MB/s左右 | GPU的3D使用率：25-30<br/>体验：有明显掉帧，流畅度一般<br/>播放时操作窗口：有卡顿感<br/>播放时输入字符：有卡顿感<br/>X0vncserver：（系统监视器）<br/>CPU使用率：70-80%<br/>网络：4-6MB/s左右 | GPU的3D使用率：15-20<br/>体验：较流畅，掉帧情况比2K下好<br/>播放时操作窗口：较流畅<br/>播放时输入字符：较流畅<br/>X0vncserver：（系统监视器）<br/>CPU使用率：70-80%<br/>网络：4-6MB/s左右 | GPU的3D使用率：30-40<br/>体验：有明显掉帧，流畅度差<br/>播放时操作窗口：有卡顿感<br/>播放时输入字符：有卡顿感<br/>X0vncserver：（系统监视器）<br/>CPU使用率：70-80%<br/>网络：4-6MB/s左右 | 性能数据和2205系统作为客户端接近，后续未进行测试             | 性能数据和2205系统作为客户端接近，后续未进行测试             |
| H265-4K-30视频测试    | GPU的3D使用率：18-23<br/>体验：有明显掉帧，流畅度一般<br/>播放时操作窗口：有卡顿感<br/>播放时输入字符：有卡顿感<br/>X0vncserver：（系统监视器）<br/>CPU使用率：70-80%<br/>网络：4-6MB/s左右 | 性能数据和左右双屏接近，后续未进行测试                       | GPU的3D使用率：15-20<br/>体验：较流畅，掉帧情况比2K下好<br/>播放时操作窗口：较流畅<br/>播放时输入字符：较流畅<br/>X0vncserver：（系统监视器）<br/>CPU使用率：70-80%<br/>网络：4-6MB/s左右 | 未进行测试                                                   | 性能数据和2205系统作为客户端接近，后续未进行测试             | 性能数据和2205系统作为客户端接近，后续未进行测试             |
| H264-1K-60视频测试    | GPU的3D使用率：18-23<br/>体验：轻微掉帧，流畅度一般<br/>播放时操作窗口：稍微有一点卡顿感<br/>播放时输入字符：稍微有一点卡顿感<br/>X0vncserver：（系统监视器）<br/>CPU使用率：70-80%<br/>网络：2.5-3.5MB/s左右 | 性能数据和左右双屏接近，后续未进行测试                       | GPU的3D使用率：13-18<br/>体验：较流畅<br/>播放时操作窗口：较流畅<br/>播放时输入字符：较流畅<br/>X0vncserver：（系统监视器）<br/>CPU使用率：70-80%<br/>网络：2.5-3.5MB/s左右 | 未进行测试                                                   | 性能数据和2205系统作为客户端接近，后续未进行测试             | 性能数据和2205系统作为客户端接近，后续未进行测试             |
| H265-1K-60视频测试    | GPU的3D使用率：18-23<br/>体验：轻微掉帧，流畅度一般<br/>播放时操作窗口：稍微有一点卡顿感<br/>播放时输入字符：稍微有一点卡顿感<br/>X0vncserver：（系统监视器）<br/>CPU使用率：70-80%<br/>网络：2.5-3.5MB/s左右 | 性能数据和左右双屏接近，后续未进行测试                       | GPU的3D使用率：18-23<br/>体验：较流畅<br/>播放时操作窗口：较流畅<br/>播放时输入字符：较流畅<br/>X0vncserver：（系统监视器）<br/>CPU使用率：70-80%<br/>网络：2.5-3.5MB/s左右 | 未进行测试                                                   | 性能数据和2205系统作为客户端接近，后续未进行测试             | 性能数据和2205系统作为客户端接近，后续未进行测试             |
| webgl测试（724-demo） | **2K全屏显示**<br/>GPU的3D使用率：80-85<br/>体验：流畅度一般<br/>播放时操作窗口：稍微有一点卡顿感<br/>播放时输入字符：稍微有一点卡顿感<br/>X0vncserver：（系统监视器）<br/>CPU使用率：70-90%<br/>网络：1-2MB/s左右 | 性能数据和左右双屏接近，后续未进行测试                       | GPU的3D使用率：80-85<br/>体验：较流畅<br/>播放时操作窗口：较流畅<br/>播放时输入字符：较流畅<br/>X0vncserver：（系统监视器）<br/>CPU使用率：55-60%<br/>网络：2-3MB/s左右 | GPU的3D使用率：85-95<br/>体验：流畅度一般<br/>播放时操作窗口：稍微有一点卡顿感<br/>播放时输入字符：稍微有一点卡顿感<br/>X0vncserver：（系统监视器）<br/>CPU使用率：70-90%<br/>网络：2-3MB/s左右 | 性能数据和2205系统作为客户端接近，后续未进行测试             | 性能数据和2205系统作为客户端接近，后续未进行测试             |
| glmark2测试           | **2K全屏测试**<br/>最终得分：512<br/>GPU的3D使用率：-（不同测试项目波动较大）<br/>体验：流畅度高<br/>播放时操作窗口：流畅度高<br/>播放时输入字符：流畅度高<br/>X0vncserver：（系统监视器）<br/>CPU使用率：50-70%<br/>网络：1-2MB/s左右（部分测试项目网络会飙升到10MB/s） | 性能数据和左右双屏接近，后续未进行测试                       | **1K全屏测试**<br/>最终得分：1415<br/>GPU的3D使用率：-（不同测试项目波动较大）<br/>体验：流畅度高<br/>播放时操作窗口：流畅度高<br/>播放时输入字符：流畅度高<br/>X0vncserver：（系统监视器）<br/>CPU使用率：50-70%<br/>网络：1-2MB/s左右（部分测试项目网络会飙升到10MB/s） | **2K全屏测试**<br/>最终得分：530<br/>GPU的3D使用率：-（不同测试项目波动较大）<br/>体验：流畅度高<br/>播放时操作窗口：流畅度高<br/>播放时输入字符：流畅度高<br/>X0vncserver：（系统监视器）<br/>CPU使用率：50-70%<br/>网络：1-2MB/s左右（部分测试项目网络会飙升到10MB/s） | 性能数据和2205系统作为客户端接近，后续未进行测试             | 性能数据和2205系统作为客户端接近，后续未进行测试             |



### 分辨率切换测试

- **主屏的设置以服务端内的设置为准，客户端的主屏设置不会影响服务端。**



- **客户端的物理屏幕接口命名（HDMI1、HDMI2）不一定和服务端保持一致，vnc只保证屏幕的分辨率和相对位置关系一致。**

  例如：

  服务端，左1K+右2K，左边接口是HDMI1（1K），右边是HDMI2（2K）。

  客户端，左1K+右2K，左边接口是HDMI2（1K），右边是HDMI1（2K）。



- **连接过程中在服务端系统设置内调整屏幕顺序/切换分辨率，会导致显示异常。**

  目前选择的显示模式，VNC客户端会强制将服务端的分辨率改为客户端屏幕当前对应的分辨率。

  **屏幕位置关系：**

  关闭连接，调整客户端屏幕位置关系。

  重新连接，服务端屏幕位置关系自动和客户端保持一致。

  不关闭连接，最小化vncviewer。调整客户端屏幕位置关系。

  打开vncviewer，服务端屏幕位置关系自动和客户端保持一致。

  在被控的服务端内ssh控制客户端，命令行切换屏幕位置关系，观察切换过程。黑屏，之后切换成功。表现正常。

  **分辨率：**

  关闭连接，调整客户端屏幕分辨率。

  重新连接，服务端屏幕分辨率自动和客户端保持一致。

  不关闭连接，最小化vncviewer。调整客户端屏幕分辨率。

  打开vncviewer，服务端屏幕分辨率自动和客户端保持一致。

  在被控的服务端内ssh控制客户端，命令行切换屏幕分辨率，观察切换过程。黑屏，之后切换成功。表现正常。



## 测试总结

- 5.4.18-65（2207）系统作为服务端（server）时，GPU使用率比 5.4.18-52（2205）系统作为服务端（server）高出10%左右。目前是怀疑系统的窗口管理器特效开的太多，导致**显卡性能消耗大**。

  后续测试中，5.4.18-65（2207）系统出现移动窗口粘任务栏问题，**综合考虑后不使用该系统**。

- **1K+1K的组合，能够满足基本使用**。在播放视频等画面变动大的场景时，效果会受到影响，存在掉帧的情况。

- **2K+1K、2K+2K、4K+1K等等，性能表现差**，待后续分析性能瓶颈点进行优化。

- **切换分辨率、调整屏幕位置关系，建议在客户端中进行**，服务端中直接调整**目前有问题**。
